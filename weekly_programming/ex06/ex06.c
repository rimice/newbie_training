/**********************************************************************************************
*** Filename:
***		ex06.c
***	Copyright (c) 2013 Wistron
***	All rights reserved.
***
***	Description:
***		 Get 10000000 numbers from a file and sort them
		 from small to large.
***
***	Author/Creat Date:
*** 		Tenix Xu, July 19,13
***
***	Note:
***
************************************************************************************************/
#include<stdio.h>
#include<stdlib.h>


/******************************************************************
*** DEFINES
*******************************************************************/
#define N 10000000
#define SHIFT 5
#define MASK 0X1F
#define WORD 32
int bitmap[1+N/WORD];

/***************************************************************************************************************************************************
***	Description:
***			Set the bitmap
****************************************************************************************************************************************************/
void set_bit(int i)
{
	bitmap[i>>SHIFT] |= (1<<(i&MASK));
}

/***************************************************************************************************************************************************
***	Description:
***			Clear the bitmap
****************************************************************************************************************************************************/
void clear_bit(int i)
{
	bitmap[i>>SHIFT] &= ~(1<<(i&MASK));
}


/***************************************************************************************************************************************************
***	Description:
***			Test the bitmap 
***	Return Value:
***			Return a number which is in the bitmap
****************************************************************************************************************************************************/
int test_bit(int i)
{
	return bitmap[i>>SHIFT] & (1<<(i&MASK));
}


/****************************************************************************************************************************************************
***	Description: 
***			The main function
****************************************************************************************************************************************************/
void main()
{
	FILE *file = fopen("file.txt","r");
	FILE *out = fopen("out.txt","w+");
	if(file == NULL || out == NULL)
	{
		printf("open is error\n");
		exit(1);
	}
	else
		printf("open is ok\n");
	int i = 0;
	int number;
	for(i=0;i<N;i++)
	{
		clear_bit(i);
	}
	printf("clear all bit is ok\n");
	
	while(!feof(file))
	{
		fscanf(file,"%d",&number);
		set_bit(number);
	}
	printf("set all bit is ok\n");
	

	for(i=0;i<N;i++)
	{
		if(test_bit(i))
		{
			fprintf(out,"%d\n",i);
		}

	}
	fclose(file);
	fclose(out);
	printf("close is ok\n");
}




